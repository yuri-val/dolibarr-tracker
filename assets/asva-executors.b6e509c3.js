import{_ as c,a as u,b as p,c as o}from"./tslib.6d8141ce.js";var h=function(){function e(n){this.runCount=0,this.wasLastRunFine=!1,this.wasRun=!1,this.wasRunFine=!1,this.wasRunBad=!1,this.command=n}return e.createAndRun=function(n){return n=new e(n),n.run(),n},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.runCount},enumerable:!1,configurable:!0}),e.prototype.run=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];this.beforeRun();var i=this.command.apply(this,n);return this.afterRun(i),i},e.prototype.beforeRun=function(){this.runCount++},e.prototype.afterRun=function(n){var t=this;n.then(function(){t.runCount--,t.setRunResultFlags(!0)}),n.catch(function(){t.runCount--,t.setRunResultFlags(!1)})},e.prototype.setRunResultFlags=function(n){this.wasRun=!0,(this.wasLastRunFine=n)&&(this.wasRunFine=!0),n||(this.wasRunBad=!0)},e}();(function(e){function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.cachedPromise=null,t}return c(n,e),n.prototype.run=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this.cachedPromise||(this.cachedPromise=e.prototype.run.apply(this,t)),this.cachedPromise},n.prototype.runFresh=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this.cachedPromise=e.prototype.run.apply(this,t),this.cachedPromise},n.prototype.cleanCache=function(){this.cachedPromise=null},n})(h);var f=function(e){function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.trigger=null,t}return c(n,e),n.prototype.run=function(){for(var t=this,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(this.isRunning)return new Promise(function(a){t.trigger=function(){return t.run.apply(t,i).then(a)}});var s=e.prototype.run.apply(this,i);return s.then(function(){t.trigger&&t.trigger(),t.trigger=null}),s},n}(h),m=function(){function e(n,t){t===void 0&&(t=3e3),this.identityCheck={},this.isWaiting=!1,this.executor=new h(n),this.timeout=t}return Object.defineProperty(e.prototype,"isRunning",{get:function(){return this.executor.isRunning},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isActive",{get:function(){return this.isRunning||this.isWaiting},enumerable:!1,configurable:!0}),e.prototype.run=function(){for(var n=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.isWaiting=!0;var r=this.registerIdentity();setTimeout(function(){var s;n.checkIdentity(r)&&(n.isWaiting=!1,(s=n.executor).run.apply(s,t))},this.timeout)},e.prototype.reset=function(){this.isWaiting=!1,this.identityCheck={}},e.prototype.registerIdentity=function(){return this.identityCheck={},this.identityCheck},e.prototype.checkIdentity=function(n){return this.identityCheck===n},e}();(function(){function e(n,t){var i=this;t===void 0&&(t=20),this.items=[],this.isFinished=!1,this.isRefreshing=!1,this.perStep=20,this.pointer=0,this.isFresh=!0,this.executor=new f(function(r){return r===void 0&&(r=!1),u(i,void 0,void 0,function(){return o(this,function(s){switch(s.label){case 0:return[4,this.runRequest(n,r)];case 1:return[2,s.sent()]}})})}),this.perStep=t}return Object.defineProperty(e.prototype,"isRunning",{get:function(){return this.executor.isRunning},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return!this.executor.isRunning&&this.isFinished&&this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFull",{get:function(){return!this.isFresh&&!this.executor.isRunning&&!!this.items.length},enumerable:!1,configurable:!0}),e.prototype.next=function(){this.executor.run()},e.prototype.refresh=function(){this.executor.run(!0)},e.prototype.runRequest=function(n,t){return t===void 0&&(t=!1),u(this,void 0,Promise,function(){var i;return o(this,function(r){switch(r.label){case 0:(t=this.pointer===0?!0:t)&&(this.pointer=0,this.isFresh=!0,this.isRefreshing=!0,this.isFinished=!1),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,n(this.pointer,this.perStep)];case 2:return i=r.sent(),Array.isArray(i)?(i.length<this.perStep&&(this.isFinished=!0),this.applyNew(i),this.pointer=this.pointer+this.perStep,this.isFresh=!1,[3,5]):(console.warn("InfiniteLoader function must return array"),[2]);case 3:throw i=r.sent(),this.isFinished=!0,i;case 4:return this.isRefreshing=!1,[7];case 5:return[2]}})})},e.prototype.applyNew=function(n){this.isFresh?this.items=n:this.items=p(p([],this.items),n)},e})();var l=function(){function e(){}return e.sleep=function(n){return new Promise(function(t){return setTimeout(t,n)})},e}();(function(){function e(n,t,i){t===void 0&&(t=100),i===void 0&&(i=1e3),this.iterationCount=0,this.command=n,this.timeout=t,this.maxTime=i}return e.waitUntil=function(n,t,i){return u(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,new e(n,t,i).run()];case 1:return r.sent(),[2]}})})},Object.defineProperty(e.prototype,"timeElapsed",{get:function(){return this.timeout*this.iterationCount},enumerable:!1,configurable:!0}),e.prototype.takesTooLong=function(){return this.timeElapsed>this.maxTime},e.prototype.run=function(){return u(this,void 0,Promise,function(){var n;return o(this,function(t){switch(t.label){case 0:this.iterationCount=0,n=this.command(),t.label=1;case 1:return n?[3,3]:[4,l.sleep(this.timeout)];case 2:if(t.sent(),this.iterationCount++,this.takesTooLong())throw new Error("Max time ("+this.maxTime+") elapsed.");return n=this.command(),[3,1];case 3:return[2]}})})},e})();(function(e){function n(t,i){return i===void 0&&(i=null),t=e.call(this,t)||this,t.state=i,t}return c(n,e),n.createAndRun=function(t,i){return i=new n(t,i=i===void 0?null:i),i.run(),i},n.prototype.run=function(){for(var t=this,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var s=e.prototype.run.apply(this,i);return s.then(function(a){t.state=a}),s},n})(h);export{m as D};
